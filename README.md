# Data Analyst Agent Demo

This demo is designed to showcase end-to-end agentic e-commerce flows using Skyfire technologies. It features a prompt-based AI agent interface that interacts with services via the Model Context Protocol (MCP).

The agent has been tasked with purchasing -
```
A dataset for pickup truck sales
- Time period: 2024
- Geographic focus: US
- Data points: Sales volumes, pricing trends etc
- Format: CSV or Excel
- Budget: $0.005
```

## Live Demo Link
You can play with the live demo [here](https://data-analyst-agent-okta-demo-74464367970.us-central1.run.app).

## Flow

- The buyer agent already has an account with Skyfire and Skyfire's Identity and Payment MCP server is already setup in the buyer agent
- The buyer agent is instructed to acquire a dataset for pickup truck sales in US
- The buyer agent will use Skyfire’s find-seller tool to find a seller for the requested data & retrieves the MCP server URL of the seller (CarbonArc)
Note: 
For this demo, Skyfire works as a directory of services from which the CarbonArc MCP Server URL is fetched using find-seller tool. In general, any public or private registry could be used to discover the available sellers. Official Skyfire Identity & Payment MCP Server will expose all the available sellers using a MCP resource.
- The buyer agent will use Skyfire’s create-kya-token tool to identify the agent
- The buyer agent will use CarbonArc's create-account-and-login tool to create an account with CarbonArc using a session token generated by Ory
- The buyer agent will use CarbonArc’s search-dataset tool to find the right dataset
- The buyer agent will use CarbonArc’s get-pricing tool to get the price of dataset <”Title”>
- The buyer agent will use Skyfire’s create-payment-token tool to make a payment to CarbonArc
- The buyer agent will use CarbonArc’s download-dataset tool to allow CarbonArc to collect the payment and ask for the downloaded dataset

Here is a diagram explaining the flow:
![WebSequence Flow Diagram](https://github.com/skyfire-xyz/skyfire-solutions-okta-demo/blob/main/static/images/websequence_flow_diagram.png?raw=true)

## Pre-requisites

To run this demo, 
- Follow the [Skyfire Platform Setup Guide](https://docs.skyfire.xyz/docs/introduction) to create Skyfire API key, complete Buyer and Seller Onboarding.

- Set up an Ory account: 
Ory is the default CIAM being used in this demo. Take a look at our [partnership with Ory](https://www.ory.sh/blog/enabling-the-agentic-economy-with-ory-and-skyfire) integrating KYAPay with CIAMs to secure the CarbonArc MCP server (the seller of the data).
[Blog](https://www.ory.sh/blog/agentic-ai-security-mcp-oauth) to refer for more details on Ory + MCP integration.

Steps to be followed for setting up Ory:
1. Visit the [Ory Console](https://console.ory.sh)
2. Create a new workspace
3. Create a project in the new workspace
4. Use the Project ID, Project Slug, API endpoints etc details from Project Settings tab in env variables in [CarbonArc MCP Server](https://github.com/skyfire-xyz/skyfire-solutions-okta-demo/tree/main/mcp-servers/carbonarc-seller-server).

- Git clone Ory MCP repo from [here](https://github.com/ory/mcp) and use npm link to tie [mcp-access-control](https://github.com/ory/mcp/tree/main/packages/mcp-access-control) package into CarbonArc MCP server. This will be a npm package in a few days.

## Contents: 

- MCP Servers:
The following MCP servers are based on the SSE transport protocol.
1. Skyfire Identity & Payment MCP Server
2. CarbonArc MCP Server
3. Reporting MCP Server

- Data Analyst Agent

## Installation Steps

1.  Clone the repository:
    ```bash
    git clone https://github.com/skyfire-xyz/skyfire-solutions-okta-demo.git
    ```
2. Follow instructions in each sub-directory.
3. Setup OpenAI account and get API key for LLM.

## Reference videos
1. ![Skyfire setup](https://github.com/skyfire-xyz/skyfire-solutions-okta-demo/blob/main/static/videos/skyfire_setup.mov)
  - Get the Buyer API key, Seller API key, Seller ID and Seller Service ID for env variables
2. ![Ory setup](https://github.com/skyfire-xyz/skyfire-solutions-okta-demo/blob/main/static/videos/ory_setup.mov)
  - Get the API key and Project Slug and use those for ORY_API_KEY and ORY_PROJECT_ID env variables
3. ![Demo setup](https://github.com/skyfire-xyz/skyfire-solutions-okta-demo/blob/main/static/videos/demo_setup.mov)
  - Use the values saved during Skyfire and Ory setup

## Note:
Take a look at the live demo [here](https://data-analyst-agent-okta-demo-74464367970.us-central1.run.app).