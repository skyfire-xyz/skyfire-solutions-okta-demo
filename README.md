# Data Analyst Agent Demo

This demo is designed to showcase end-to-end agentic e-commerce flows using Skyfire technologies. It features a prompt-based AI agent interface that interacts with services via the Model Context Protocol (MCP).

The agent has been tasked with purchasing -
```
A dataset for pickup truck sales
- Time period: 2024
- Geographic focus: US
- Data points: Sales volumes, pricing trends etc
- Format: CSV or Excel
- Budget: $0.005
```

## Live Demo Link
You can play with the live demo [here](https://data-analyst-agent-okta-demo-74464367970.us-central1.run.app).

## Flow
- The buyer agent already has an account with Skyfire and Skyfire's Identity and Payment MCP server is already setup in the buyer agent
- The buyer agent is instructed to acquire a dataset for pickup truck sales in US
- The buyer agent will use Skyfire’s find-sellers tool to find a seller for the requested data & retrieves the MCP server URL of the seller (Dappier)
Note: 
For this demo, Skyfire works as a directory of services from which the Dappier MCP Server URL is fetched using find-sellers tool. In general, any public or private registry could be used to discover the available sellers. Official Skyfire Identity & Payment MCP Server will expose all the available sellers using a MCP resource.
- The buyer agent will use Skyfire’s create-kya-token tool to identify the agent
- The buyer agent will use Dappier's create-account-and-login tool to create an account with Dappier using a custom exchange token generated by Auth0
- The buyer agent will use Dappier’s search-dataset tool to find the right dataset
- The buyer agent will use Dappier’s get-pricing tool to get the price of dataset <”Title”>
- The buyer agent will use Skyfire’s create-payment-token tool to make a payment to Dappier
- The buyer agent will use Dappier’s download-dataset tool to allow Dappier to collect the payment and ask for the downloaded dataset

Here is a diagram explaining the flow:
![WebSequence Flow Diagram](https://github.com/skyfire-xyz/skyfire-solutions-okta-demo/blob/main/static/images/websequence_flow_diagram.png?raw=true)

## Pre-requisites
To run this demo, 
- Follow the [Skyfire Platform Setup Guide](https://docs.skyfire.xyz/docs/introduction) to create Skyfire API key, complete Buyer and Seller Onboarding.
- Set up an Auth0 account: 
Auth0 is the default CIAM being used in this demo. 

Steps to be followed for setting up Auth0:
1. Visit the [Auth0 Dashboard](https://manage.auth0.com/dashboard/)
2. Create a new tenant
3. Follow the [Auth0 official documentation for creating a new custom token exchange profile](https://auth0.com/docs/authenticate/custom-token-exchange)
4. Use the Auth0 Client ID, Client Secret, Domain etc details from Settings tab of your newly created Application in env variables in [Dappier MCP Server](https://github.com/skyfire-xyz/skyfire-solutions-okta-demo/tree/main/mcp-servers/dappier-seller-server).
5. [Sample code for creating Auth0 Action](https://github.com/skyfire-xyz/skyfire-solutions-okta-demo/tree/main/auth0/sample-action-code.ts) or refer to [Auth0 Marketplace implementation](https://github.com/dlozlla/opensource-marketplace/blob/feat-cte-template-skyfire-hardened/templates/skyfire-token-exchange-CUSTOM_TOKEN_EXCHANGE/code.js)

## Contents: 

- MCP Servers:
The following MCP servers are based on the HTTP streamable transport protocol.
1. Dappier MCP Server
2. Reporting MCP Server
3. Skyfire Identity & Payment MCP Server

- For the skyfire mcp you will be using https://mcp-qa.skyfire.xyz/mcp as the endpoint to connect to. Enter it as the value for the environment variable SKYFIRE_MCP_URL.


## Installation Steps

1.  Clone the repository:
    ```bash
    git clone https://github.com/skyfire-xyz/skyfire-solutions-okta-demo.git
    ```
2. Follow instructions in each sub-directory.
3. Setup OpenAI account and get API key for LLM.

## Note:
Take a look at the live demo [here](https://data-analyst-agent-okta-demo-74464367970.us-central1.run.app).